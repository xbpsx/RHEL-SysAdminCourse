## Центральный процессор (CPU)

### Что такое центральный процессор?

**Центральный процессор (CPU)** — это "мозг" компьютера, аппаратный компонент, который выполняет вычисления и инструкции программ. Если представить компьютер как фабрику:

- **CPU** — это рабочие на фабрике, которые выполняют конкретные задачи

- **Память** — это склад с материалами и инструментами

- **Диски** — это архив с чертежами и долгосрочными запасами

---
### Для системного администратора CPU — это:

#### 1. **Критический ресурс производительности**

```bash
# Мониторинг загрузки CPU
top
htop
mpstat 1  # из пакета sysstat

# Просмотр информации о CPU
lscpu
cat /proc/cpuinfo
```

#### 2. **Объект планирования и распределения**

Операционная система распределяет время CPU между процессами, создавая иллюзию параллельного выполнения.

#### 3. **Источник проблем с производительностью**

Когда CPU перегружен, система "тормозит", даже если есть свободная память и дисковое пространство.

### Практическая работа с CPU для системного администратора

#### Мониторинг загрузки CPU:

```bash
# Базовая команда
top

# Более продвинутый мониторинг
htop

# Детальная статистика
sar -u 1 5  # статистика за 5 секунд с интервалом 1 сек

# Нагрузка на отдельные ядра
mpstat -P ALL 1

# Исторические данные
sar -q
```

#### Анализ процессов, нагружающих CPU:

```bash
# Процессы, сортированные по использованию CPU
ps aux --sort=-%cpu | head -10

# Альтернатива
top -o %CPU

# Поиск процессов, потребляющих много CPU
pidstat 1 5  # из пакета sysstat
```

#### Практические сценарии для админа:

**Сценарий 1: Экстренная ситуация — 100% загрузка CPU**

```bash
#!/bin/bash
# cpu_emergency_check.sh

CPU_THRESHOLD=95
CURRENT_LOAD=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)

if (( $(echo "$CURRENT_LOAD > $CPU_THRESHOLD" | bc -l) )); then
    echo "CRITICAL: CPU load at ${CURRENT_LOAD}%"
    echo "Top CPU consumers:"
    ps aux --sort=-%cpu | head -6
    
    # Автоматические действия
    echo "Analyzing running processes..."
    pidstat 1 3
    
    # Уведомление
    wall "Внимание: высокая загрузка CPU! Проведите диагностику."
fi
```

**Сценарий 2: Анализ распределения по ядрам**

```bash
#!/bin/bash
# cpu_core_analysis.sh

echo "=== Распределение нагрузки по ядрам CPU ==="
mpstat -P ALL 1 3 | grep -E "(CPU|Average)"

echo -e "\n=== Процессы, привязанные к конкретным ядрам ==="
ps -eo pid,psr,pcpu,comm --sort=-pcpu | head -10
```

**Сценарий 3: Настройка приоритетов CPU**

```bash
# Запуск процесса с пониженным приоритетом
nice -n 10 ./heavy_script.sh

# Изменение приоритета уже running процесса
renice 10 -p 1234

# Привязка процесса к конкретному ядру CPU
taskset -c 0,1 ./application  # использовать только ядра 0 и 1
```

#### Ключевые метрики CPU для мониторинга:

- **%user** — время в пользовательских процессах

- **%system** — время в системных вызовах

- **%iowait** — время ожидания I/O операций

- **load average** — средняя нагрузка за 1, 5, 15 минут

### Центральный процессор (CPU):

- **Что**: Аппаратный вычислительный ресурс

- **Зачем**: Выполняет инструкции программ

- **Мониторинг**: Нагрузка, распределение по ядрам, время ожидания

- **Управление**: Приоритеты, привязка к ядрам, ограничения