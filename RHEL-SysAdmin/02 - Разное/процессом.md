### Что такое процесс?

**Процесс** — это экземпляр выполняемой программы со всем своим окружением. Это не просто программа, а "живой" объект в системе, который включает:

1. **Код программы** (что выполнять)

2. **Данные** (с чем работать)

3. **Состояние выполнения** (где сейчас находится)

4. **Ресурсы** (память, файлы, сетевые соединения)

5. **Контекст** (переменные окружения, права доступа)

### Для системного администратора процесс — это:

#### 1. **Единица управления**

Процессы можно запускать, останавливать, приостанавливать, возобновлять.

#### 2. **Объект мониторинга**

Каждый процесс потребляет ресурсы (CPU, память, I/O).

#### 3. **Источник проблем**

Процессы могут "зависать", потреблять слишком много ресурсов, создавать утечки.

---
### Практическая работа с процессами

#### Создание и управление процессами:

```bash
# Запуск процесса
./my_script.sh

# Запуск в фоне
./server.sh &

# Просмотр запущенных процессов
ps aux
ps -ef

# Дерево процессов (очень полезно!)
pstree -p
pstree -pan
```

#### Мониторинг процессов:

```bash
# Динамический просмотр
top
htop

# Поиск процесса по имени
pgrep nginx
ps aux | grep nginx

# Детальная информация о процессе
cat /proc/<PID>/status
cat /proc/<PID>/io  # I/O статистика
```

#### Управление процессами:

```bash
# Корректное завершение
kill <PID>
kill -TERM <PID>

# Принудительное завершение
kill -KILL <PID>
kill -9 <PID>

# Завершение процессов по имени
pkill nginx
killall nginx

# Приостановка и возобновление
kill -STOP <PID>  # приостановить
kill -CONT <PID>  # возобновить
```

#### Практические сценарии для админа:

**Сценарий 1: Мониторинг жизненного цикла сервиса**

```bash
#!/bin/bash
# service_monitor.sh

SERVICE="nginx"
CHECK_INTERVAL=30

while true; do
    if ! pgrep -x "$SERVICE" > /dev/null; then
        echo "WARNING: $SERVICE is not running! Attempting to restart..."
        systemctl start $SERVICE
        # Или отправка уведомления
        echo "Service $SERVICE was restarted at $(date)" >> /var/log/service_monitor.log
    fi
    sleep $CHECK_INTERVAL
done
```

**Сценарий 2: Анализ дерева процессов**

```bash
#!/bin/bash
# process_tree_analysis.sh

echo "=== Полное дерево процессов ==="
pstree -pan

echo -e "\n=== Процессы, потребляющие много ресурсов ==="
ps aux --sort=-%cpu | head -5
echo "---"
ps aux --sort=-%mem | head -5

echo -e "\n=== Процессы-сироты (родитель PID=1) ==="
ps -eo pid,ppid,comm | awk '$2==1 {print}'
```

**Сценарий 3: Управление группами процессов**

```bash
#!/bin/bash
# process_group_management.sh

# Запуск группы процессов
./worker1.sh &
./worker2.sh &
./worker3.sh &

# Запись PID группы
WORKER_GROUP=$!

# Управление всей группой
echo "Worker group PID: $WORKER_GROUP"

# Приостановка всей группы
kill -STOP $WORKER_GROUP
echo "Workers paused"

sleep 10

# Возобновление группы
kill -CONT $WORKER_GROUP
echo "Workers resumed"

# Завершение всей группы
kill $WORKER_GROUP
```

**Сценарий 4: Анализ ресурсов процесса**

```bash
#!/bin/bash
# process_resource_analysis.sh

PID=$1

if [ -z "$PID" ]; then
    echo "Usage: $0 <PID>"
    exit 1
fi

echo "=== Анализ ресурсов процесса $PID ==="

# Основная информация
echo "Команда: $(ps -p $PID -o comm=)"
echo "Пользователь: $(ps -p $PID -o user=)"
echo "Потребление CPU: $(ps -p $PID -o %cpu=)"
echo "Потребление памяти: $(ps -p $PID -o %mem=)"

# Файловые дескрипторы
echo -e "\nОткрытые файлы:"
lsof -p $PID | head -10

# Потребление памяти
echo -e "\nИспользование памяти:"
pmap -x $PID | tail -1

# I/O статистика
echo -e "\nI/O статистика:"
cat /proc/$PID/io
```

#### Ключевые состояния процессов:

- **Running** — выполняется

- **Sleeping** — ожидает события

- **Stopped** — приостановлен

- **Zombie** — завершен, но не удален из таблицы процессов
#### Сигналы для управления процессами:

```bash
SIGHUP    (1)  # Перезагрузить конфигурацию
SIGINT    (2)  # Прервать (Ctrl+C)
SIGQUIT   (3)  # Аварийное завершение
SIGKILL   (9)  # Принудительное завершение
SIGTERM  (15)  # Корректное завершение
SIGSTOP  (19)  # Приостановка
SIGCONT  (18)  # Возобновление
```

### Процесс:

- **Что**: Выполняемый экземпляр программы с окружением

- **Зачем**: Единица работы в операционной системе

- **Мониторинг**: Состояние, ресурсы, дерево процессов

- **Управление**: Запуск, остановка, приостановка, сигналы

**Сильный системный администратор умеет:**

- Быстро находить процессы, потребляющие критичные ресурсы

- Понимать взаимосвязь между процессами и нагрузкой на CPU

- Эффективно управлять жизненным циклом процессов

- Настраивать приоритеты и ограничения для важных сервисов

- Автоматизировать мониторинг и реагирование на проблемы

